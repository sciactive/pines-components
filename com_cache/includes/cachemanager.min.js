pines(function(){function I(){var e={};e.component=n.find("[name=component]").val()=="Home"?"":n.find("[name=component]").val();e.caction=n.find("[name=action]").val();e.cachequery=n.find("[name=cachequery]").val();e.cacheloggedin=n.find("[name=cacheloggedin]").val();e.cachetime=n.find("[name=cachetime]").val();e.domain=n.find("[name=domain]").val();e.maintain_exceptions=n.find(".exception-btn").attr("data-exceptions");e.manage=n.find("[name=manage]").val();$.ajax({url:P,type:"POST",dataType:"json",data:e,error:function(){d.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("edit-cancel");return},success:function(e){if(!e){d.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("edit-cancel")}else{location.href=H}}})}function q(e,t){var n=e.val();var r=e.attr("name");var i={};if(r=="cache_on")i.cache_on=n;else if(r=="parent_directory")i.parent_directory=n;else if(r=="delete_cacheoptions")i.delete_cacheoptions=n;$.ajax({url:F,type:"POST",dataType:"json",data:i,error:function(){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("setting-cancel");return},success:function(e){if(!e){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel").addClass("setting-cancel")}else{location.href=H}}})}function R(e,t,n){var r={};r.component=e.filter("[name=component]").val()=="Home"?"":e.filter("[name=component]").val();r.caction=e.filter("[name=action]").val();r.cachequery=e.filter("[name=cachequery]").val();r.cacheloggedin=e.filter("[name=cacheloggedin]").val();r.cachetime=e.filter("[name=cachetime]").val();r.domain=e.filter("[name=domain]").val();$.ajax({url:F,type:"POST",dataType:"json",data:r,error:function(){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel");return},success:function(e){if(!e){n.fadeIn();t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel")}else{location.href=H}}})}function U(){var e={};e.domain=t.find("[name=refresh_domain]").val();e.file_name=t.find("[name=file_name]").val();$.ajax({url:j,type:"POST",dataType:"json",data:e,error:function(){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel");return},success:function(e){if(!e){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel")}else{location.href=H}}})}function z(e){var t={};t.domain=e;$.ajax({url:j,type:"POST",dataType:"json",data:t,error:function(){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel");return},success:function(e){if(!e){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel")}else{location.href=H}}})}function W(e,t){var n=0;e.each(function(){var e=$(this);if(!(e.attr("name")=="action")&&e.val()==""){n++}});if(n!=0){t.removeClass("btn-success").addClass("btn-info")}else{t.addClass("btn-success").removeClass("btn-info")}}function X(e){var t='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var n=$("<div></div>");var r=$("<div></div>");$.each(e,function(e,i){if(e=="isset"){$.each(i,function(e,r){var i=$("<tr></tr>");i.append('<td class="name">'+r+"</td>");i.append(t);n.append(i)})}else if(e=="value"){$.each(i,function(e,n){$.each(n,function(n,i){var s=$("<tr></tr>");s.append('<td class="name">'+e+"</td>");s.append('<td class="value">'+i+"</td>");s.append(t);r.append(s)})})}});var i={};i.isset=n.html();i.value=r.html();return i}function V(){var e=k.find(".table.isset");var t=e.find("tbody tr");var n=k.find(".table.value");var r=n.find("tbody tr");var i={};i.isset=[];i.value={};t.each(function(){var e=$(this).find("td.name").text();i.isset.push(e)});r.each(function(){var e=$(this).find("td.name").text();var t=$(this).find("td.value").text();if(i.value[e]==undefined){i.value[e]=[]}i.value[e].push(t)});if(!t.length&&!r.length)var s="";else var s=JSON.stringify(i);k.find('[name="exceptions"]').val(s).change()}function J(){var e={};e.component=k.find("[name=component]").val();e.caction=k.find("[name=caction]").val();e.domain=k.find("[name=domain]").val();e.exceptions=k.find("[name=exceptions]").val();$.ajax({url:F,type:"POST",dataType:"json",data:e,error:function(){O.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("exceptions-cancel");return},success:function(e){if(!e){O.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("exceptions-cancel")}else{location.href=H}}})}function K(e,t){$.ajax({url:B,type:"POST",dataType:"json",data:{path:e},beforeSend:function(){t.html('<div style="margin: 30px; text-align:center;"><i class="icon-spin icon-spinner icon-2x"></i><br/><br/>Loading</div>')},error:function(){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>');return},success:function(e){if(!e){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>')}else if(!e.length){t.html('<div class="text-center">There are no files in this directory.</div>')}else{var n=$('<table class="table table-bordered table-hover"></table>');var r=$("<thead><th>File Name</th><th>Last Cached</th></thead>");var i=$("<tbody></tbody>");n.append(r);$.each(e,function(e,t){var n=$("<tr></tr>");n.append("<td>"+pines.safe(t.filename)+"</td>");n.append('<td><span class="mtime" title="'+pines.safe(t.timeago)+'">'+pines.safe(t.mtime)+"</span></td>");i.append(n)});n.append(r).append(i);n.find(".mtime").timeago();t.hide().html("").append(n).fadeIn()}}})}function Q(e,t,n){$.ajax({url:B,type:"POST",dataType:"json",data:{domain:e},beforeSend:function(){t.html('<div style="margin: 30px; text-align:center;"><i class="icon-spin icon-spinner icon-2x"></i><br/><br/>Loading</div>');n.html('<div class="text-center">Select a folder from which to view files.</div>')},error:function(){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>');return},success:function(e){if(!e){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>')}else{var r=$('<div class="new-tree"></div>');r.jstree({plugins:["themes","json_data","ui"],json_data:e,ui:{select_limit:1,initially_select:["localhost"]}}).bind("select_node.jstree",function(e,t){var r=t.inst.get_selected().attr("data-path");K(r,n)});t.hide().html("").append(r).fadeIn()}}})}var e=$(".p_cache_cachemanager");var t=e.find(".item.modal");var n=e.find(".edit-directive.modal");var r=e.find(".refresh-item");var i=e.find(".refresh-submit");var s=e.find("td.edit-directive");var o=e.find(".edit-symbol");var u=e.find(".edit-helper");var a=e.find(".helper");var f=e.find(".disable-directive-btn");var l=e.find(".disable-directive-name");var c=e.find(".disable-directive-button-name");var h=e.find(".delete-directive-btn");var p=n.find("[name=manage]");var d=n.find(".item-submit");var v=n.find(".save-info");var m=n.find(".check-edit");var g=e.find(".submit-new");var y=e.find(".add-info");var b=e.find(".add");var w=e.find(".show-add-modal");var E=e.find(".add-modal");var S=e.find(".add[name=domain]");var x=e.find(".edit-setting-btn");var T=e.find(".cache-setting");var N=e.find("button.refresh-domain");var C=e.find(".example");var k=e.find(".exception.modal");var L=e.find(".exception-readmore-link");var A=e.find(".exception-readmore");var O=e.find(".submit-exceptions");var M=e.find(".details.modal");var _=e.find(".view-domain");var D=e.find(".cache-urls");var P=D.find(".save-edit-url").text();var H=D.find(".cache-manager-url").text();var B=D.find(".domain-explore-url").text();var j=D.find(".refresh-url").text();var F=D.find(".save-url").text();D.remove();e.on("click",".readmore",function(){var e=$(this);var t=e.find(".readless");e.removeClass("readmore");setTimeout(function(){t.addClass("in")},350)});e.on("click",".readless",function(){$(this).removeClass("in").closest("li").addClass("readmore")});r.click(function(){var e=$(this).attr("data-name");var n=$(this).attr("data-filename");t.find(".item-name").text(e);t.find("[name=file_name]").val(n);t.modal()});t.find("[name=refresh_domain]").change(function(){if($(this).val()!="")i.addClass("btn-success").removeClass("btn-info");else{i.removeClass("btn-success btn-danger").addClass("btn-info")}});i.click(function(){if(i.hasClass("refresh-success")){i.removeClass("btn-danger").addClass("btn-info").html("Refresh");t.find("[name=refresh_domain]").val();return}if(!i.hasClass("btn-success"))return;i.html('<i class="icon-spin icon-spinner"></i>');U()});N.click(function(){var e=$(this);var t=e.attr("data-domain");if(e.hasClass("refresh-success")){e.removeClass("btn-danger").html('<i class="icon-refresh"></i>');return}if(e.hasClass("btn-danger"))return;e.html('<i class="icon-spin icon-spinner"></i>');z(t)});s.hover(function(){var e=$(this);var t=e.width();var n=e.offset();var r=n.top;var i=n.left;o.attr("style","position: absolute; top:"+(r+5)+"px; left:"+(i+t)+"px;");if(e.hasClass("no-icon"))return;o.show()},function(){o.hide()});s.click(function(){var e=$(this);var t=e.closest("tr");var r=t.find("[data-name]").attr("data-name");var i=t.find("td.component").text();var s=t.find("td.action").text();var o=t.find("td.cachequery").text().replace(/\s/g,"");var u=t.find("td.cacheloggedin").text();var a=t.find("td.cachetime").text();var h=t.find("td.domain").text();var p=t.find(".exception-btn").length?t.find(".exception-btn"):undefined;n.find(".exception-btn").remove();n.find(".item-name").text(r);n.find("[name=component]").val(i);n.find("[name=action]").val(s);n.find("option").prop("selected",false);n.find("[name=cachequery]").find("option:contains('"+o+"')").prop("selected",true);n.find("[name=cachequery]").attr("data-orig",o);var m=t.find(".exceptions-span");var p=t.find(".exception-btn");var g=p.length?p.attr("data-exceptions").replace(/"/g,"&quot;"):m.length?m.attr("data-exceptions").replace(/"/g,"&quot;"):"";var y=p.hasClass("btn-success")?"btn-success":"";var b='<button style="width:48%; float:right;padding:4px;" class="btn btn-mini exception-btn '+y+'" data-name="'+r+'" data-component="'+i+'" data-action="'+s+'" data-domain="'+h+'" data-exceptions="'+g+'">Exceptions</button>';if(p.length){n.find("[name=cachequery]").after(b).css("width","48%").removeClass("full-field")}else{n.find("[name=cachequery]").removeAttr("style").addClass("full-field").after(b);n.find(".exception-btn").addClass("hide")}n.find("[name=cacheloggedin]").find("option:contains('"+u+"')").prop("selected",true);n.find("[name=cacheloggedin]").attr("data-orig",u);n.find("[name=cachetime]").val(a).attr("data-orig",a);n.find("[name=domain]").val(h).attr("data-orig",h);if(t.find("span[data-name]").length&&t.find("span[data-name]").text()!="No Files"){l.text("Enable");c.text("Enable");f.addClass("btn-success").removeClass("btn-warning")}else{l.text("Disable");c.text("Only Disable");f.removeClass("btn-success").addClass("btn-warning")}d.addClass("btn-info").removeClass("btn-success");v.hide();e.addClass("cur-edit");n.modal()});e.find("[name=cachetime]").keyup(function(){this.value=this.value.replace(/\D/,"")});u.add(a).tooltip();f.click(function(){if(f.hasClass("disabled"))return;f.toggleClass("active");if(f.hasClass("active")){h.addClass("disabled");if(f.hasClass("btn-success"))p.val("enable").change();else p.val("disable").change()}else{h.removeClass("disabled");p.val("").change()}});h.click(function(){if(h.hasClass("disabled"))return;h.toggleClass("active");if(h.hasClass("active")){f.addClass("disabled");p.val("delete").change()}else{f.removeClass("disabled");p.val("").change()}});p.change(function(){if(p.val()!=""){d.removeClass("btn-info").addClass("btn-success");v.fadeIn()}else if(!p.hasClass("altered")){d.addClass("btn-info").removeClass("btn-success");v.hide()}});m.change(function(){var e=$(this);if(e.val()!=e.attr("data-orig")){d.removeClass("btn-info").addClass("btn-success");v.fadeIn();p.addClass("altered")}else if(p.val()==""){d.addClass("btn-info").removeClass("btn-success");v.hide()}});d.click(function(){if(!d.hasClass("btn-success"))return;else{d.html('<i class="icon-spin icon-spinner"></i>');I()}});b.change(function(){var e=$(this).closest("tr.add-parent");var t=!e.length;var n=t?E.find(".add"):e.find(".add");var r=t?E.find(".submit-new"):e.find(".submit-new");y.hide();if(n.filter("[name=component]").val()=="Home")n.filter("[name=action]").val("").addClass("disabled").attr("disabled","disabled");else n.filter("[name=action]").removeClass("disabled").removeAttr("disabled");W(n,r)});g.click(function(){var t=$(this);var n=t.closest(".add-parent");var r=n.find(".add");var i=n.find(".add-info").length?n.find(".add-info"):e.find(".add-info-after-table");if(!t.hasClass("btn-success"))return;else{t.html('<i class="icon-spin icon-spinner"></i>');R(r,t,i)}});w.click(function(){g.removeClass("btn-success").addClass(".btn-info");y.hide();b.removeClass("disabled").removeAttr("disabled").val("");E.modal()});e.on("click",".add-cancel",function(){var e=$(this);if(e.hasClass("submit-new")){e.removeClass("add-cancel")}g.removeClass("btn-success btn-danger").addClass("btn-info").html('<i class="icon-plus"></i> Add');y.hide();b.removeClass("disabled").removeAttr("disabled").val("")});e.on("click",".edit-cancel",function(){var e=$(this);if(e.hasClass("item-submit")){e.removeClass("edit-cancel")}d.removeClass("btn-success btn-danger").addClass("btn-info").html("Save");v.hide();f.add(h).removeAttr("disabled").removeClass("active disabled");p.val("");n.modal("hide")});S.focusin(function(){var e=$(this);if(e.val()==""){e.val("all").select()}}).focusout(function(){$(this).change()});x.click(function(){var t=$(this);var n=t.closest("tr").find(".cache-setting");if(t.hasClass("btn-info")){if(n.val()==n.attr("data-orig")){n.attr("disabled","disabled");t.removeClass("btn-success btn-info")}}else if(t.hasClass("btn-success")){if(t.hasClass("import")){var r=e.find("[name=import]").val();r=r.replace(/\..*$/,"");if(H.match(/\?/)){var i=H+"&import="+r}else{var i=H+"?import="+r}location.href=i;return}t.html('<i class="icon-spin icon-spinner"></i>');q(n,t)}else if(t.hasClass("setting-cancel")){n.val(n.attr("data-orig"));t.removeClass("btn-danger setting-cancel").addClass("btn-info").html('<i class="icon-pencil"></i> Edit')}else{n.removeAttr("disabled");t.addClass("btn-info")}});T.change(function(){var e=$(this);var t=e.closest("tr").find(".edit-setting-btn");if(e.val()!=e.attr("data-orig")){t.html('<i class="icon-save"></i> Save').addClass("btn-success").removeClass("btn-danger btn-info")}else{t.html('<i class="icon-pencil"></i> Edit').removeClass("btn-success").addClass("btn-info")}});e.find(".show-import").click(function(){e.find(".show-import-table").fadeIn()});e.find(".show-example").click(function(){if(C.is(":visible"))C.fadeOut();else{C.fadeIn()}});e.on("click",".exception-btn",function(){var e=$(this);var t=e.attr("data-name");var n=e.attr("data-component");var r=e.attr("data-action");var i=e.attr("data-domain");var s=e.attr("data-exceptions");if(s==""){var o="";var u=""}else{var a=s.replace(/&quot;/,'"');var f=JSON.parse(a);var o=X(f).isset;var u=X(f).value}k.find(".item-name").text(t);k.find("[name=component]").val(n);k.find("[name=caction]").val(r);k.find("[name=domain]").val(i);k.find("[name=orig_exceptions]").val(s);k.find("[name=exceptions]").val(s);k.find(".table.isset tbody").html(o);k.find(".table.value tbody").html(u);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();V()});k.modal()});L.click(function(){A.toggleClass("hide");V()});k.find(".add-isset-btn").click(function(){var e=k.find(".table.isset tbody");var t=$(this).closest("tr");var n=t.find("[name=add_isset]");var r=n.val();if(r=="")return;var i=true;e.find("td.name").each(function(){var e=$(this);if(e.text()==r){pines.notice("That variable name is already an exception.","notice");i=false;return}});n.val("");if(!i)return;var s='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var o=$("<tr></tr>");o.append('<td class="name">'+r+"</td>");o.append(s);e.append(o);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();V()});V()});k.find(".add-value-btn").click(function(){var e=k.find(".table.value tbody");var t=$(this).closest("tr");var n=t.find("[name=add_value_name]");var r=n.val();var i=t.find("[name=add_value]");var s=i.val();if(r==""||s=="")return;var o=true;e.find("td.name").each(function(){var e=$(this);if(e.text()==r){var t=e.closest("tr").find("td.value").text();if(t==s){pines.notice("That combination of name and value exists.","notice");o=false;return}}});n.add(i).val("");if(!o)return;var u='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var a=$("<tr></tr>");a.append('<td class="name">'+r+"</td>");a.append('<td class="value">'+s+"</td>");a.append(u);e.append(a);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();V()});V()});k.find("[name=exceptions]").change(function(){var e=$(this);var t=e.val();var n=k.find("[name=orig_exceptions]").val();if(n==t){O.addClass("btn-info").removeClass("btn-success")}else{O.removeClass("btn-info").addClass("btn-success")}});O.click(function(){if(O.hasClass("btn-success")){O.html('<i class="icon-spin icon-spinner"></i>');J()}else if(O.hasClass("exceptions-cancel")){O.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")}});e.find(".cancel-exceptions").click(function(){O.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")});_.click(function(){var e=$(this).attr("data-domain");M.find(".item-name").text(e);var t=M.find(".jstree-container");var n=M.find(".files-container");Q(e,t,n);M.modal()});var G=e.find(".directives-table tbody tr").length;e.find(".num-directives").html(G-1)});