/*
 * com_cache's JS
 * 
 * @package Components\cache
 * @license http://www.gnu.org/licenses/agpl-3.0.html
 * @author Angela Murrell <amasiell.g@gmail.com>
 * @copyright SciActive.com
 * @link http://sciactive.com/
 */
pines(function(){function Y(){var e={};e.component=n.find("[name=component]").val()=="Home"?"":n.find("[name=component]").val();e.caction=n.find("[name=action]").val();e.cachequery=n.find("[name=cachequery]").val();e.cacheloggedin=n.find("[name=cacheloggedin]").val();e.cachetime=n.find("[name=cachetime]").val();e.domain=n.find("[name=domain]").val();e.maintain_exceptions=n.find(".exception-btn").attr("data-exceptions");e.maintain_unique_users=n.find(".unique-users-btn").attr("data-users");e.manage=n.find("[name=manage]").val();$.ajax({url:W,type:"POST",dataType:"json",data:e,error:function(){d.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("edit-cancel");return},success:function(e){if(!e){d.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("edit-cancel")}else{location.href=X}}})}function Z(e,t){var n=e.val();var r=e.attr("name");var i={};if(r=="cache_on")i.cache_on=n;else if(r=="parent_directory")i.parent_directory=n;else if(r=="delete_cacheoptions")i.delete_cacheoptions=n;$.ajax({url:Q,type:"POST",dataType:"json",data:i,error:function(){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("setting-cancel");return},success:function(e){if(!e){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel").addClass("setting-cancel")}else{location.href=X}}})}function et(e,t,n){var r={};r.component=e.filter("[name=component]").val()=="Home"?"":e.filter("[name=component]").val();r.caction=e.filter("[name=action]").val();r.cachequery=e.filter("[name=cachequery]").val();r.cacheloggedin=e.filter("[name=cacheloggedin]").val();r.cachetime=e.filter("[name=cachetime]").val();r.domain=e.filter("[name=domain]").val();$.ajax({url:Q,type:"POST",dataType:"json",data:r,error:function(){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel");return},success:function(e){if(!e){n.fadeIn();t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("add-cancel")}else{location.href=X}}})}function tt(){var e={};e.domain=t.find("[name=refresh_domain]").val();e.file_name=t.find("[name=file_name]").val();$.ajax({url:K,type:"POST",dataType:"json",data:e,error:function(){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel");return},success:function(e){if(!e){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel")}else{location.href=X}}})}function nt(e){var t={};t.domain=e;$.ajax({url:K,type:"POST",dataType:"json",data:t,error:function(){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel");return},success:function(e){if(!e){i.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("refresh-cancel")}else{location.href=X}}})}function rt(e,t){var n=0;e.each(function(){var e=$(this);if(!(e.attr("name")=="action")&&e.val()==""){n++}});if(n!=0){t.removeClass("btn-success").addClass("btn-info")}else{t.addClass("btn-success").removeClass("btn-info")}}function it(e){var t='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var n=$("<div></div>");var r=$("<div></div>");$.each(e,function(e,i){if(e=="isset"){$.each(i,function(e,r){var i=$("<tr></tr>");i.append('<td class="name">'+r+"</td>");i.append(t);n.append(i)})}else if(e=="value"){$.each(i,function(e,n){$.each(n,function(n,i){var s=$("<tr></tr>");s.append('<td class="name">'+e+"</td>");s.append('<td class="value">'+i+"</td>");s.append(t);r.append(s)})})}});var i={};i.isset=n.html();i.value=r.html();return i}function st(){var e=k.find(".table.isset");var t=e.find("tbody tr");var n=k.find(".table.value");var r=n.find("tbody tr");var i={};i.isset=[];i.value={};t.each(function(){var e=$(this).find("td.name").text();i.isset.push(e)});r.each(function(){var e=$(this).find("td.name").text();var t=$(this).find("td.value").text();if(i.value[e]==undefined){i.value[e]=[]}i.value[e].push(t)});if(!t.length&&!r.length)var s="";else var s=JSON.stringify(i);k.find('[name="exceptions"]').val(s).change()}function ot(){var e={};e.component=k.find("[name=component]").val();e.caction=k.find("[name=caction]").val();e.domain=k.find("[name=domain]").val();e.exceptions=k.find("[name=exceptions]").val();$.ajax({url:Q,type:"POST",dataType:"json",data:e,error:function(){O.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("exceptions-cancel");return},success:function(e){if(!e){O.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("exceptions-cancel")}else{location.href=X}}})}function ut(e){var t='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-user"><i class="icon-remove"></i></button></td>';var n=$("<div></div>");$.each(e,function(e,r){var i=$("<tr></tr>");i.append('<td class="name">'+r+"</td>");i.append(t);n.append(i)});var r={};r=n.html();return r}function at(){var e=j.find(".table.users");var t=e.find("tbody tr");var n=[];t.each(function(){var e=$(this).find("td.name").text();n.push(e)});var r;if(!t.length)r="";else r=JSON.stringify(n);j.find('[name="unique_users"]').val(r).change()}function ft(){var e={};e.component=j.find("[name=component]").val();e.caction=j.find("[name=caction]").val();e.domain=j.find("[name=domain]").val();e.all_unique=j.find("[name=all_unique]").val();e.unique_users=j.find("[name=unique_users]").val();e.save_unique_users=true;$.ajax({url:Q,type:"POST",dataType:"json",data:e,error:function(){F.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("users-cancel");return},success:function(e){if(!e){F.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger").addClass("users-cancel")}else{location.href=X}}})}function lt(e,t){$.ajax({url:J,type:"POST",dataType:"json",data:{path:e},beforeSend:function(){t.html('<div style="margin: 30px; text-align:center;"><i class="icon-spin icon-spinner icon-2x"></i><br/><br/>Loading</div>')},error:function(){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>');return},success:function(e){if(!e){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>')}else if(!e.length){t.html('<div class="text-center">There are no files in this directory.</div>')}else{var n=$('<table class="table table-bordered table-hover"></table>');var r=$("<thead><th>File Name</th><th>Last Cached</th></thead>");var i=$("<tbody></tbody>");n.append(r);$.each(e,function(e,t){var n=$("<tr></tr>");n.append("<td>"+pines.safe(t.filename)+"</td>");n.append('<td><span class="mtime" title="'+pines.safe(t.timeago)+'">'+pines.safe(t.mtime)+"</span></td>");i.append(n)});n.append(r).append(i);n.find(".mtime").timeago();t.hide().html("").append(n).fadeIn()}}})}function ct(e,t,n){$.ajax({url:J,type:"POST",dataType:"json",data:{domain:e},beforeSend:function(){t.html('<div style="margin: 30px; text-align:center;"><i class="icon-spin icon-spinner icon-2x"></i><br/><br/>Loading</div>');n.html('<div class="text-center">Select a folder from which to view files.</div>')},error:function(){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>');return},success:function(e){if(!e){t.html('<div class="text-error" style="margin: 30px; text-align:center;"><i class="icon-remove icon-2x"></i><br/><br/>Error</div>')}else{var r=$('<div class="new-tree"></div>');r.jstree({plugins:["themes","json_data","ui"],json_data:e,ui:{select_limit:1,initially_select:["localhost"]}}).bind("select_node.jstree",function(e,t){var r=t.inst.get_selected().attr("data-path");lt(r,n)});t.hide().html("").append(r).fadeIn()}}})}function ht(){H.find(".error").hide();H.find(".success").hide();var e=[];H.find(".exception-row td.user").each(function(){var t=$(this);var n=t.text();if(!t.hasClass("dull")&&n.length)e.push(n)});var t=[];H.find(".exception-row td.group").each(function(){var e=$(this);var n=e.text();if(!e.hasClass("dull")&&n.length)t.push(n)});var n={};n.users=e;n.groups=t;$.ajax({url:V,type:"POST",dataType:"json",data:n,beforeSend:function(){H.find(".success").hide();H.find(".saving").fadeIn()},error:function(){H.find(".success").hide();H.find(".saving").hide();H.find(".error").fadeIn();return},success:function(e){if(!e){H.find(".success").hide();H.find(".saving").hide();H.find(".error").fadeIn()}else{H.find(".saving").hide();H.find(".success").fadeIn()}setTimeout(function(){H.find(".success, .error, .saving").fadeOut()},3e3)}})}function pt(e){var t="[name="+e+"]";var n=H.find(".exception-new");var r=H.find(".exception-row").last();var i=H.find(t);var s=i.val();if(s=="")return;var o=e=="excep_user"?r.find("td").first():r.find("td").last();if(e=="excep_user"){if(o.hasClass("dull")){H.find(".dull.user").first().text(s).toggleClass("dull remove-exception")}else{n.before('<tr class="exception-row"><td colspan="2" class="user remove-exception" style="width: 50%;">'+s+'</td><td colspan="2" class="dull group" style="width: 50%;"></td></tr>')}}else{if(o.hasClass("dull")){H.find(".dull.group").first().text(s).toggleClass("dull remove-exception")}else{n.before('<tr class="exception-row"><td colspan="2" class="dull user" style="width: 50%;"></td><td colspan="2" class="group remove-exception" style="width: 50%;">'+s+"</td></tr>")}}i.val("").change()}function dt(e,t){var n={};n.domain="all";n.ability_hash=e;$.ajax({url:K,type:"POST",dataType:"json",data:n,error:function(){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger");return},success:function(e){if(e===false){t.html('<i class="icon-undo"></i>').removeClass("btn-success").addClass("btn-danger")}else{t.closest(".hash-result").html('<span class="text-success"><i class="icon-ok"></i> Refreshed '+e+" file(s)!</span>")}}})}function vt(t){var n={};n.username=t;$.ajax({url:G,type:"POST",dataType:"json",data:n,beforeSend:function(){R.html('<i class="icon-spin icon-spinner"></i> Searching the Database...');q.html('<i class="icon-spin icon-spinner"></i>').removeClass("btn-success btn-info").addClass("btn-danger");e.find(".ability-badge").hide();e.find(".unique-badge").hide()},error:function(){R.html("Did not find this user or it failed.");q.html('<i class="icon-undo"></i>').removeClass("btn-success btn-info").addClass("btn-danger");return},success:function(t){if(!t){R.html("Did not find this user or it failed.");q.html('<i class="icon-undo"></i>').removeClass("btn-success btn-info").addClass("btn-danger")}else{q.html('<i class="icon-undo"></i>').removeClass("btn-danger btn-info").addClass("btn-success");var n='<table class="table hash-result-table table-bordered"><tbody><tr><td class="text-center hash"><input type="text" class="hash-label full-field text-center" value="'+pines.safe(t.ability_hash)+'"></td><td class="text-center hash-control"><span class="hash-refresh"><i class="icon-refresh"></i></span></td></tr></tbody></table>';R.filter(".ability").html(n);var r=t.ability_count>0?"badge-success":"badge-info";e.find(".ability-badge").removeClass("badge-success badge-info").addClass(r).text(t.ability_count).fadeIn();if(t.unique_hash!=undefined){var i='<table class="table hash-result-table table-bordered"><tbody><tr><td class="text-center hash"><input type="text" class="hash-label full-field text-center" value="'+pines.safe(t.unique_hash)+'"></td><td class="text-center hash-control"><span class="hash-refresh"><i class="icon-refresh"></i></span></td></tr></tbody></table>';R.filter(".unique").html(i);var s=t.unique_count>0?"badge-success":"badge-info";e.find(".unique-badge").removeClass("badge-success badge-info").addClass(s).text(t.unique_count).fadeIn()}else{R.filter(".unique").html("No unique hash.")}R.find(".hash-label").click(function(){$(this).select()})}}});q.addClass("clear")}var e=$(".p_cache_cachemanager");var t=e.find(".item.modal");var n=e.find(".edit-directive.modal");var r=e.find(".refresh-item");var i=e.find(".refresh-submit");var s=e.find("td.edit-directive");var o=e.find(".edit-symbol");var u=e.find(".edit-helper");var a=e.find(".helper");var f=e.find(".disable-directive-btn");var l=e.find(".disable-directive-name");var c=e.find(".disable-directive-button-name");var h=e.find(".delete-directive-btn");var p=n.find("[name=manage]");var d=n.find(".item-submit");var v=n.find(".save-info");var m=n.find(".check-edit");var g=e.find(".submit-new");var y=e.find(".add-info");var b=e.find(".add");var w=e.find(".show-add-modal");var E=e.find(".add-modal");var S=e.find(".add[name=domain]");var x=e.find(".edit-setting-btn");var T=e.find(".cache-setting");var N=e.find("button.refresh-domain");var C=e.find(".example");var k=e.find(".exception.modal");var L=e.find(".exception-readmore-link");var A=e.find(".exception-readmore");var O=e.find(".submit-exceptions");var M=e.find(".details.modal");var _=e.find(".view-domain");var D=e.find(".global-exceptions-btn");var P=e.find(".global-exceptions-input");var H=e.find(".global-exceptions-modal.modal");var B=H.find(".add-exception");var j=e.find(".unique-users-modal");var F=e.find(".submit-users");var I=e.find("[name=check_user_hash]");var q=e.find(".lookup-btn");var R=e.find(".hash-result");var U=e.find(".apply-btn");var z=e.find(".cache-urls");var W=z.find(".save-edit-url").text();var X=z.find(".cache-manager-url").text();var V=z.find(".save-exception-url").text();var J=z.find(".domain-explore-url").text();var K=z.find(".refresh-url").text();var Q=z.find(".save-url").text();var G=z.find(".check-user-hash-url").text();z.remove();q.click(function(){if(q.hasClass("clear")){I.val("");R.html(R.attr("data-orig"));q.html('<i class="icon-search"></i>').removeClass("btn-danger btn-success clear").addClass("btn-info");I.focus();e.find(".ability-badge").hide();e.find(".unique-badge").hide();return}var t=I.val();if(t=="")return;vt(t)});I.focusin(function(){if(q.hasClass("clear")){I.val("");e.find(".ability-badge").hide();e.find(".unique-badge").hide();R.html(R.attr("data-orig"));q.html('<i class="icon-search"></i>').removeClass("btn-danger btn-success clear").addClass("btn-info")}});I.keypress(function(t){var n=$(this);if(n.val()!=""&&t.which==13){q.click()}else if(q.hasClass("clear")){e.find(".ability-badge").hide();e.find(".unique-badge").hide();R.html(R.attr("data-orig"));q.html('<i class="icon-search"></i>').removeClass("btn-danger btn-success clear").addClass("btn-info")}});e.on("click",".hash-refresh",function(){var e=$(this);var t=e.closest("tr").find(".hash input").val();e.html('<i class="icon-spin icon-spinner"></i>');dt(t,e)});var mt=function(t){e.find(t+".readmore").each(function(){var e=$(this);if(e.attr("data-height")==undefined){e.css("visibility","hidden");e.css("height","auto");var t=e.outerHeight();e.removeAttr("style");e.attr("data-height",t)}})};mt("li.span4");e.on("click",".readmore",function(){var e=$(this);var t=e.find(".readless");e.removeClass("readmore");e.animate({height:e.attr("data-height")},"fast");setTimeout(function(){t.addClass("in")},350)});e.on("click",".readless",function(){$(this).removeClass("in").closest("li, .alert").removeAttr("style").addClass("readmore")});r.click(function(){var e=$(this).attr("data-name");var n=$(this).attr("data-filename");t.find(".item-name").text(e);t.find("[name=file_name]").val(n);t.modal()});t.find("[name=refresh_domain]").change(function(){if($(this).val()!="")i.addClass("btn-success").removeClass("btn-info");else{i.removeClass("btn-success btn-danger").addClass("btn-info")}});i.click(function(){if(i.hasClass("refresh-success")){i.removeClass("btn-danger").addClass("btn-info").html("Refresh");t.find("[name=refresh_domain]").val();return}if(!i.hasClass("btn-success"))return;i.html('<i class="icon-spin icon-spinner"></i>');tt()});N.click(function(){var e=$(this);var t=e.attr("data-domain");if(e.hasClass("refresh-success")){e.removeClass("btn-danger").html('<i class="icon-refresh"></i>');return}if(e.hasClass("btn-danger"))return;e.html('<i class="icon-spin icon-spinner"></i>');nt(t)});s.hover(function(){var e=$(this);var t=e.width();var n=e.offset();var r=n.top;var i=n.left;o.attr("style","position: absolute; top:"+(r+5)+"px; left:"+(i+t)+"px;");if(e.hasClass("no-icon"))return;o.show()},function(){o.hide()});s.click(function(){var e=$(this);var t=e.closest("tr");var r=t.find("[data-name]").attr("data-name");var i=t.find("td.component").text();var s=t.find("td.action").text();var o=t.find("td.cachequery").text().replace(/\s/g,"");var u=t.find("td.cacheloggedin").text().replace(/\s/g,"");var a=t.find("td.cachetime").text();var h=t.find("td.domain").text();n.find(".exception-btn").remove();n.find(".unique-users-btn").remove();n.find(".item-name").text(r);n.find("[name=component]").val(i);n.find("[name=action]").val(s);n.find("option").prop("selected",false);n.find("[name=cachequery]").find("option:contains('"+o+"')").prop("selected",true);n.find("[name=cachequery]").attr("data-orig",o);var p=t.find(".exceptions-span");var m=t.find(".exception-btn");var g=m.length?m.attr("data-exceptions").replace(/"/g,"&quot;"):p.length?p.attr("data-exceptions").replace(/"/g,"&quot;"):"";var y=m.hasClass("btn-success")?"btn-success":"";var b='<button style="width:48%; float:right;padding:4px;" class="btn btn-mini exception-btn '+y+'" data-name="'+r+'" data-component="'+i+'" data-action="'+s+'" data-domain="'+h+'" data-exceptions="'+g+'">Exceptions</button>';if(m.length){n.find("[name=cachequery]").after(b).css("width","48%").removeClass("full-field")}else{n.find("[name=cachequery]").removeAttr("style").addClass("full-field").after(b);n.find(".exception-btn").addClass("hide")}var w=t.find(".unique-users-span");var E=t.find(".unique-users-btn");var S=E.length?E.attr("data-users").replace(/"/g,"&quot;"):w.length?w.attr("data-users").replace(/"/g,"&quot;"):"";var x=E.hasClass("btn-success")?"btn-success":"";var T='<button style="width:48%; float:right;padding:4px;" class="btn btn-mini unique-users-btn '+x+'" data-name="'+r+'" data-component="'+i+'" data-action="'+s+'" data-domain="'+h+'" data-users="'+S+'">Unique Users</button>';if(E.length){n.find("[name=cacheloggedin]").after(T).css("width","48%").removeClass("full-field")}else{n.find("[name=cacheloggedin]").removeAttr("style").addClass("full-field").after(T);n.find(".unique-users-btn").addClass("hide")}n.find("[name=cacheloggedin]").find("option:contains('"+u+"')").prop("selected",true);n.find("[name=cacheloggedin]").attr("data-orig",u);n.find("[name=cachetime]").val(a).attr("data-orig",a);n.find("[name=domain]").val(h).attr("data-orig",h);if(t.find("span[data-name]").length&&t.find("span[data-name]").text()!="No Files"){l.text("Enable");c.text("Enable");f.addClass("btn-success").removeClass("btn-warning")}else{l.text("Disable");c.text("Only Disable");f.removeClass("btn-success").addClass("btn-warning")}d.addClass("btn-info").removeClass("btn-success");v.hide();e.addClass("cur-edit");n.modal()});e.find("[name=cachetime]").keyup(function(){this.value=this.value.replace(/\D/,"")});u.add(a).tooltip();f.click(function(){if(f.hasClass("disabled"))return;f.toggleClass("active");if(f.hasClass("active")){h.addClass("disabled");if(f.hasClass("btn-success"))p.val("enable").change();else p.val("disable").change()}else{h.removeClass("disabled");p.val("").change()}});h.click(function(){if(h.hasClass("disabled"))return;h.toggleClass("active");if(h.hasClass("active")){f.addClass("disabled");p.val("delete").change()}else{f.removeClass("disabled");p.val("").change()}});p.change(function(){if(p.val()!=""){d.removeClass("btn-info").addClass("btn-success");v.fadeIn()}else if(!p.hasClass("altered")){d.addClass("btn-info").removeClass("btn-success");v.hide()}});m.change(function(){var e=$(this);if(e.val()!=e.attr("data-orig")){d.removeClass("btn-info").addClass("btn-success");v.fadeIn();p.addClass("altered")}else if(p.val()==""){d.addClass("btn-info").removeClass("btn-success");v.hide()}});d.click(function(){if(!d.hasClass("btn-success"))return;else{d.html('<i class="icon-spin icon-spinner"></i>');Y()}});b.change(function(){var e=$(this).closest("tr.add-parent");var t=!e.length;var n=t?E.find(".add"):e.find(".add");var r=t?E.find(".submit-new"):e.find(".submit-new");y.hide();if(n.filter("[name=component]").val()=="Home")n.filter("[name=action]").val("").addClass("disabled").attr("disabled","disabled");else n.filter("[name=action]").removeClass("disabled").removeAttr("disabled");rt(n,r)});g.click(function(){var t=$(this);var n=t.closest(".add-parent");var r=n.find(".add");var i=n.find(".add-info").length?n.find(".add-info"):e.find(".add-info-after-table");if(!t.hasClass("btn-success"))return;else{t.html('<i class="icon-spin icon-spinner"></i>');et(r,t,i)}});w.click(function(){g.removeClass("btn-success").addClass(".btn-info");y.hide();b.removeClass("disabled").removeAttr("disabled").val("");E.modal()});e.on("click",".add-cancel",function(){var e=$(this);if(e.hasClass("submit-new")){e.removeClass("add-cancel")}g.removeClass("btn-success btn-danger").addClass("btn-info").html('<i class="icon-plus"></i> Add');y.hide();b.removeClass("disabled").removeAttr("disabled").val("")});e.on("click",".edit-cancel",function(){var e=$(this);if(e.hasClass("item-submit")){e.removeClass("edit-cancel")}d.removeClass("btn-success btn-danger").addClass("btn-info").html("Save");v.hide();f.add(h).removeAttr("disabled").removeClass("active disabled");p.val("");n.modal("hide")});S.focusin(function(){var e=$(this);if(e.val()==""){e.val("all").select()}}).focusout(function(){$(this).change()});x.click(function(){var t=$(this);var n=t.closest("tr").find(".cache-setting");if(t.hasClass("btn-info")){if(n.val()==n.attr("data-orig")){n.attr("disabled","disabled");t.removeClass("btn-success btn-info")}}else if(t.hasClass("btn-success")){if(t.hasClass("import")){var r=e.find("[name=import]").val();r=r.replace(/\..*$/,"");if(X.match(/\?/)){var i=X+"&import="+r}else{var i=X+"?import="+r}location.href=i;return}t.html('<i class="icon-spin icon-spinner"></i>');Z(n,t)}else if(t.hasClass("setting-cancel")){n.val(n.attr("data-orig"));t.removeClass("btn-danger setting-cancel").addClass("btn-info").html('<i class="icon-pencil"></i> Edit')}else{n.removeAttr("disabled");t.addClass("btn-info")}});T.change(function(){var e=$(this);var t=e.closest("tr").find(".edit-setting-btn");if(e.val()!=e.attr("data-orig")){t.html('<i class="icon-save"></i> Save').addClass("btn-success").removeClass("btn-danger btn-info")}else{t.html('<i class="icon-pencil"></i> Edit').removeClass("btn-success").addClass("btn-info")}});e.find(".show-import").click(function(){e.find(".show-import-table").fadeIn()});e.find(".show-example").click(function(){if(C.is(":visible"))C.fadeOut();else{C.fadeIn();mt(".example-info")}});e.on("click",".exception-btn",function(){var e=$(this);var t=e.attr("data-name");var n=e.attr("data-component");var r=e.attr("data-action");var i=e.attr("data-domain");var s=e.attr("data-exceptions");if(s==""){var o="";var u=""}else{var a=s.replace(/&quot;/,'"');var f=JSON.parse(a);var o=it(f).isset;var u=it(f).value}k.find(".item-name").text(t);k.find("[name=component]").val(n);k.find("[name=caction]").val(r);k.find("[name=domain]").val(i);k.find("[name=orig_exceptions]").val(s);k.find("[name=exceptions]").val(s);k.find(".table.isset tbody").html(o);k.find(".table.value tbody").html(u);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();st()});k.modal()});L.click(function(){A.toggleClass("hide");st()});k.find(".add-isset-btn").click(function(){var e=k.find(".table.isset tbody");var t=$(this).closest("tr");var n=t.find("[name=add_isset]");var r=n.val();if(r=="")return;var i=true;e.find("td.name").each(function(){var e=$(this);if(e.text()==r){pines.notice("That variable name is already an exception.","notice");i=false;return}});n.val("");if(!i)return;var s='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var o=$("<tr></tr>");o.append('<td class="name">'+r+"</td>");o.append(s);e.append(o);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();st()});st()});k.find(".add-value-btn").click(function(){var e=k.find(".table.value tbody");var t=$(this).closest("tr");var n=t.find("[name=add_value_name]");var r=n.val();var i=t.find("[name=add_value]");var s=i.val();if(r==""||s=="")return;var o=true;e.find("td.name").each(function(){var e=$(this);if(e.text()==r){var t=e.closest("tr").find("td.value").text();if(t==s){pines.notice("That combination of name and value exists.","notice");o=false;return}}});n.add(i).val("");if(!o)return;var u='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-exception"><i class="icon-remove"></i></button></td>';var a=$("<tr></tr>");a.append('<td class="name">'+r+"</td>");a.append('<td class="value">'+s+"</td>");a.append(u);e.append(a);k.find(".remove-exception").click(function(){var e=$(this).closest("tr");e.remove();st()});st()});k.find("[name=exceptions]").change(function(){var e=$(this);var t=e.val();var n=k.find("[name=orig_exceptions]").val();if(n==t){O.addClass("btn-info").removeClass("btn-success")}else{O.removeClass("btn-info").addClass("btn-success")}});O.click(function(){if(O.hasClass("btn-success")){O.html('<i class="icon-spin icon-spinner"></i>');ot()}else if(O.hasClass("exceptions-cancel")){O.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")}});e.find(".cancel-exceptions").click(function(){O.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")});_.click(function(){var e=$(this).attr("data-domain");M.find(".item-name").text(e);var t=M.find(".jstree-container");var n=M.find(".files-container");ct(e,t,n);M.modal()});var gt=e.find(".directives-table tbody tr").length;e.find(".num-directives").html(gt-1);D.click(function(){H.modal()});B.click(function(){var e=$(this);var t=e.attr("data-input");var n=H.find("[name="+t+"]");if(n.val()=="")return;pt(t);ht()});P.change(function(){var e=$(this);var t=H.find("[data-input="+e.attr("name")+"]");if(e.val()!=""){t.addClass("btn-success")}else t.removeClass("btn-success")});P.keypress(function(e){var t=$(this);var n=H.find("[data-input="+t.attr("name")+"]");if(t.val()!=""&&e.which==13){n.click()}});H.on("click",".remove-exception",function(){var e=$(this);var t=e.closest("tr");var n=e.hasClass("user");var r=n?t.find(".group"):t.find(".user");var i=e.closest("tbody");if(r.hasClass("dull")){t.remove()}else{e.remove();var s=i.find("td.user").filter(":not(.dull)");var o=i.find("td.group").filter(":not(.dull)");i.find(".exception-row").remove();var u=s.length<o.length?o.length:s.length;for(var a=0;a<u;a++){var f=$('<tr class="exception-row"></tr>');var l=s.eq(a);var c=o.eq(a);if(!l.length&&!c.length)break;if(l.length)f.append(l);else f.append('<td style="width: 50%;" class="user dull" colspan="2" data-here="sad"></td>');if(c.length)f.append(c);else f.append('<td style="width: 50%;" class="group dull" colspan="2" data-here="mad"></td>');i.find(".exception-new").before(f)}}ht()});e.on("click",".unique-users-btn",function(){var e=$(this);var t=e.attr("data-name");var n=e.attr("data-component");var r=e.attr("data-action");var i=e.attr("data-domain");var s=!(e.attr("data-all")=="false");var o=e.attr("data-users");var u;if(o==""){u=""}else{var a=o.replace(/&quot;/,'"');var f=JSON.parse(a);u=ut(f)}j.find(".btn-group .btn").removeClass("active");var l=s?".apply-to-all":".apply-to-users";j.find(l).addClass("active");if(s){j.find(".users").addClass("disabled");j.find(".users-form [name=add_user]").attr("disabled","disabled")}else{j.find(".users").removeClass("disabled");j.find(".users-form [name=add_user]").removeAttr("disabled")}j.find(".item-name").text(t);j.find("[name=component]").val(n);j.find("[name=caction]").val(r);j.find("[name=domain]").val(i);j.find("[name=orig_unique_users]").val(o);j.find("[name=unique_users]").val(o);j.find("[name=all_unique]").val(s);j.find("[name=orig_all_unique]").val(s);j.find(".table.users tbody").html(u);j.find(".remove-user").click(function(){if(j.find(".users").hasClass("disabled"))return;var e=$(this).closest("tr");e.remove();at()});j.modal()});U.click(function(){var e=$(this);if(e.hasClass("active"))return;U.removeClass("active");e.addClass("active");var t;if(e.hasClass("apply-to-all")){t=true;j.find(".users").addClass("disabled");j.find(".users-form [name=add_user]").attr("disabled","disabled")}else{t=false;j.find(".users").removeClass("disabled");j.find(".users-form [name=add_user]").removeAttr("disabled")}j.find("[name=all_unique]").val(t);var n=!(j.find("[name=orig_all_unique]").val()=="false");var r=j.find("[name=unique_users]").val();var i=j.find("[name=orig_unique_users]").val();if(n==t&&i==r){F.addClass("btn-info").removeClass("btn-success")}else{F.removeClass("btn-info").addClass("btn-success")}});e.find(".cancel-users").click(function(){F.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")});F.click(function(){if(F.hasClass("btn-success")){F.html('<i class="icon-spin icon-spinner"></i>');ft()}else if(F.hasClass("users-cancel")){F.html('<i class="icon-plus"></i> Save').addClass("btn-info").removeClass("btn-success btn-danger")}});j.find("[name=unique_users]").change(function(){var e=$(this);var t=e.val();var n=j.find("[name=orig_unique_users]").val();if(n==t){F.addClass("btn-info").removeClass("btn-success")}else{F.removeClass("btn-info").addClass("btn-success")}});j.find(".add-user-btn").click(function(){var e=j.find(".table.users tbody");var t=$(this).closest("tr");var n=t.find("[name=add_user]");var r=n.val();if(r=="")return;var i=true;e.find("td.name").each(function(){var e=$(this);if(e.text()==r){pines.notice("That username is already listed.","notice");i=false;return}});n.val("");if(!i)return;var s='<td style="width: 30px;vertical-align:middle;" class="text-center"><button class="btn-danger btn remove-user"><i class="icon-remove"></i></button></td>';var o=$("<tr></tr>");o.append('<td class="name">'+r+"</td>");o.append(s);e.append(o);j.find(".remove-user").click(function(){var e=$(this).closest("tr");e.remove();at()});at()})});